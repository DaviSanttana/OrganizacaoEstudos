<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Organizador de Estudos Pro</title>
    <style>
        /* CONFIGURA√á√ïES GERAIS - DARK MODE */
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            max-width: 850px;
            margin: 40px auto;
            background-color: #121212;
            color: #e0e0e0;
            padding: 20px;
        }

        /* FORMUL√ÅRIO */
        #formulario {
            background: #1e1e1e;
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #333;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        input, select, button {
            padding: 12px;
            margin: 8px 5px;
            border: 1px solid #444;
            border-radius: 6px;
            background-color: #2c2c2c;
            color: white;
            outline: none;
        }

        button {
            background-color: #bb86fc;
            color: #000;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        button:hover { background-color: #9965f4; transform: translateY(-2px); }

        /* ABAS DE NAVEGA√á√ÉO */
        .abas { display: flex; gap: 15px; margin-bottom: 25px; border-bottom: 2px solid #333; }
        .aba-btn {
            background: none; border: none; color: #888;
            cursor: pointer; font-size: 1em; padding: 10px 20px;
            transition: 0.3s;
        }
        .aba-btn.ativa { color: #bb86fc; border-bottom: 3px solid #bb86fc; font-weight: bold; }

        /* CARDS DE TAREFAS */
        .tarefa-card {
            background: #1e1e1e;
            padding: 18px;
            border-left: 6px solid #bb86fc;
            margin-bottom: 15px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: 0.3s;
        }

        .concluida-style { border-left-color: #03dac6; opacity: 0.6; }
        .concluida-style h3 { text-decoration: line-through; color: #888; }

        .tempo-badge {
            background: #333;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85em;
            color: #bb86fc;
            font-weight: bold;
        }

        /* RELAT√ìRIO FINAL */
        #relatorio {
            margin-top: 50px;
            padding: 25px;
            background: #1e1e1e;
            border: 1px solid #333
            border-radius: 12px;
            border-top: 4px solid #bb86fc;
            display: flex;
            justify-content: space-around;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        .stat-item span {
         display: block;
          color: #aaa;
          margin-bottom: 8px;
          font-size: 0.9em;
          text-transform: uppercase;
          letter-spacing: 1px
          }
        .stat-item h2 {
        color: #bb86fc;
        margin: 0;
        font-size: 2em;
        text-shadow: 0 0 10px rgba(187, 134, 252, 0.3); }

        .btn-check { background-color: #bb86fc; padding: 8px 15px; font-size: 0.9em; }
        .btn-check.reabrir { background-color: #444; color: #fff; }
    </style>
</head>
<body>

<h1>üìö Organizador de Estudos</h1>

<section id="formulario">
    <form id="studyForm">
        <input type="text" id="materia" placeholder="Mat√©ria (ex: Java)" style="width: 30%;" required>
        <input type="text" id="descricao" placeholder="O que vai estudar?" style="width: 30%;">
        <select id="diaDaSemana">
            <option value="Segunda-feira">Segunda-feira</option>
            <option value="Ter√ßa-feira">Ter√ßa-feira</option>
            <option value="Quarta-feira">Quarta-feira</option>
            <option value="Quinta-feira">Quinta-feira</option>
            <option value="Sexta-feira">Sexta-feira</option>
        </select>
        <input type="number" id="tempoMinutos" placeholder="Minutos" style="width: 80px;" required>
        <button type="submit">Adicionar</button>
    </form>
</section>

<div class="abas">
    <button class="aba-btn ativa" onclick="filtrar('todas', this)">Todas</button>
    <button class="aba-btn" onclick="filtrar('pendentes', this)">Para Fazer</button>
    <button class="aba-btn" onclick="filtrar('feitas', this)">Conclu√≠das</button>
</div>

<div id="lista-tarefas"></div>

<footer id="relatorio">
    <div class="stat-item">
        <span>Tempo Dedicado (Conclu√≠dos)</span>
        <h2 id="tempo-total">0h 00min</h2>
    </div>
    <div class="stat-item">
        <span>Mat√©rias Finalizadas</span>
        <h2 id="qtd-concluidas">0</h2>
    </div>
</footer>

<script>
    let filtroAtual = 'todas';


    document.getElementById('studyForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const dados = {
            materia: document.getElementById('materia').value,
            descricao: document.getElementById('descricao').value,
            diaDaSemana: document.getElementById('diaDaSemana').value,
            tempoMinutos: parseInt(document.getElementById('tempoMinutos').value),
            concluida: false
        };

        await fetch('/tarefas', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(dados)
        });

        e.target.reset();
        carregarTarefas();
    });


    async function carregarTarefas() {
        const resposta = await fetch('/tarefas');
        const tarefas = await resposta.json();

        atualizarRelatorio(tarefas);

        const container = document.getElementById('lista-tarefas');
        container.innerHTML = '';

        const filtradas = tarefas.filter(t => {
            if (filtroAtual === 'pendentes') return !t.concluida;
            if (filtroAtual === 'feitas') return t.concluida;
            return true;
        });

        filtradas.forEach(t => {
            container.innerHTML += `
                <div class="tarefa-card ${t.concluida ? 'concluida-style' : ''}">
                    <div>
                        <span class="tempo-badge">‚è±Ô∏è ${t.tempoMinutos} min</span>
                        <small style="color:#888"> | ${t.diaDaSemana}</small>
                        <h3 style="margin: 10px 0 5px 0;">${t.materia}</h3>
                        <p style="margin: 0; color: #bbb;">${t.descricao}</p>
                    </div>
                    <button class="btn-check ${t.concluida ? 'reabrir' : ''}" onclick="concluirTarefa(${t.id})">
                        ${t.concluida ? 'Reabrir' : 'Feito'}
                    </button>
                </div>
            `;
        });
    }


    function atualizarRelatorio(tarefas) {
        const concluidas = tarefas.filter(t => t.concluida);
        const totalMinutos = concluidas.reduce((soma, t) => soma + (t.tempoMinutos || 0), 0);

        const horas = Math.floor(totalMinutos / 60);
        const minutos = totalMinutos % 60;

        document.getElementById('tempo-total').innerText = `${horas}h ${minutos.toString().padStart(2, '0')}min`;
        document.getElementById('qtd-concluidas').innerText = concluidas.length;
    }


    function filtrar(tipo, btn) {
        filtroAtual = tipo;
        document.querySelectorAll('.aba-btn').forEach(b => b.classList.remove('ativa'));
        btn.classList.add('ativa');
        carregarTarefas();
    }

    async function concluirTarefa(id) {
        await fetch(`/tarefas/${id}/concluir`, { method: 'PUT' });
        carregarTarefas();
    }

    carregarTarefas();
</script>
</body>
</html>